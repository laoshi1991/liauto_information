<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>理想汽车南向资金持股趋势</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #main { width: 100%; height: 100vh; }
        @media (max-width: 768px) {
            #main { height: 90vh; margin-top: 20px; }
        }
    </style>
</head>
<body>
    <div id="main"></div>
    <script>
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);
        var option;

        function fetchData() {
            fetch('/api/data')
                .then(response => response.json())
                .then(data => {
                    // Process data
                    // Data structure: [{'日期': '...', '南向当日净增持：万股': ..., '南向总持有：亿股': ...}, ...]
                    // Sort by date just in case
                    data.sort((a, b) => new Date(a['日期']) - new Date(b['日期']));

                    const dates = data.map(item => item['日期']);
                    const netIncrease = data.map(item => item['南向当日净增持：万股']);
                    const totalHoldings = data.map(item => item['南向总持有：亿股']);

                    option = {
                        title: {
                            text: '理想汽车南向资金持股趋势',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'cross'
                            }
                        },
                        legend: {
                            data: ['南向当日净增持（万股）', '南向总持有（亿股）'],
                            bottom: 10
                        },
                        grid: {
                            left: '3%',
                            right: '3%',
                            bottom: '10%',
                            containLabel: true
                        },
                        xAxis: [
                            {
                                type: 'category',
                                data: dates,
                                axisPointer: {
                                    type: 'shadow'
                                }
                            }
                        ],
                        yAxis: [
                            {
                                type: 'value',
                                name: '净增持（万股）',
                                splitLine: { show: false }
                            },
                            {
                                type: 'value',
                                name: '总持有（亿股）',
                                position: 'right',
                                splitLine: { show: false }
                            }
                        ],
                        series: [
                            {
                                name: '南向当日净增持（万股）',
                                type: 'bar',
                                data: netIncrease,
                                itemStyle: {
                                    color: '#5470C6'
                                }
                            },
                            {
                                name: '南向总持有（亿股）',
                                type: 'line',
                                yAxisIndex: 1,
                                data: totalHoldings,
                                itemStyle: {
                                    color: '#EE6666'
                                },
                                showSymbol: false,
                                smooth: true
                            }
                        ]
                    };

                    myChart.setOption(option);
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        fetchData();

        window.addEventListener('resize', myChart.resize);
    </script>
</body>
</html>
